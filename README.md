# 视频检测与修复工具 (Video Detection and Repair Tool)

## 简介

本项目是一个使用 Python 和 Tkinter 构建的桌面应用程序，旨在帮助用户检测视频文件是否能够被 MoviePy 库正确处理，并提供了基于 FFmpeg 的视频修复功能，以解决常见的兼容性问题。

该工具通过分析视频的编解码器、像素格式、色彩空间等参数来识别潜在问题，并能将视频转换为更通用的格式（如 H.264 视频编码和 AAC 音频编码）。

## 主要功能

* **视频兼容性检测**：使用 FFprobe 分析视频流，识别可能与 MoviePy 不兼容的视频和音频编码、像素格式、色彩空间等问题。
* **视频修复**：
    * 将视频转换为 MoviePy 兼容的 MP4 格式 (H.264/AAC)。
    * 提供低、中、高三种转换质量选项。
    * 采用两阶段修复引擎，先解码到原始 YUV 格式再重新编码，以彻底清除有问题的元数据或侧数据。
    * 支持保持原文件名（直接替换）或生成带 `_fixed` 后缀的新文件。
    * 可选在修复成功后删除原文件（当不选择替换原文件时）。
* **批量处理**：支持添加单个或多个视频文件，或整个文件夹（可选择是否递归扫描子文件夹）进行检测和修复。
* **用户界面**：
    * 基于 Tkinter 的图形用户界面，易于操作。
    * 清晰展示文件列表、状态、视频详细信息和操作日志。
* **其他实用功能 (基于 `video_conversion.py`)**：
    * 创建视频预览片段。
    * 从视频中提取特定时间的单帧图像。
* **跨平台考虑**：已包含针对 Windows 平台设置控制台输出编码为 UTF-8 的代码。

## 技术栈

* **Python 3**
* **Tkinter** (用于 GUI)
* **FFmpeg** (用于视频处理和转换，需要预先安装并配置好环境变量)
* **FFprobe** (用于视频信息分析，通常与 FFmpeg 一起分发)

## 如何使用

1.  **环境准备**:
    * 确保你的系统已安装 Python 3。
    * 安装 FFmpeg 和 FFprobe，并将它们添加到系统的环境变量中，以便程序可以调用。程序启动时会检查依赖项并提示。
    * (可选) 如果你想从源码修改或进一步开发，可能需要 MoviePy 库 (`pip install moviepy`)，尽管此工具本身运行不直接依赖 MoviePy，而是确保输出文件与 MoviePy 兼容。

2.  **运行程序**:
    * 克隆或下载本仓库。
    * 进入项目根目录 `视频检测与修复工具/`。
    * 运行主程序：`python main.py`

3.  **操作流程**:
    * 点击 "添加视频" 或 "添加文件夹" 将视频文件导入列表。
    * 点击 "开始检测" 分析视频的兼容性。
    * 对于状态为 "错误" 的视频，可以选中后点击 "修复所选"，或直接点击 "修复全部" 来处理所有问题视频。
    * 根据需要选择 "保持原文件名（直接替换原文件）" 或取消勾选以生成新文件 (新文件将命名为 `原文件名_fixed.mp4` 或在 `video_conversion.py` 中是 `原文件名_converted_时间戳.mp4`)。
    * 如果未选择“保持原文件名”，可以选择“修复后删除原文件”选项。
    * 在 "转换质量" 下拉菜单中选择期望的输出质量。

## 文件结构

* `main.py`: 程序主入口，负责启动 Tkinter 应用。
* `video_detector.py`: 包含 `VideoDetectorApp` 类（GUI逻辑和文件处理流程）、`VideoInfo` 类（存储视频信息）和 `VideoDetector` 类（视频检测和使用两阶段修复逻辑）。
* `video_conversion.py`: 包含 `VideoConverter` 类，封装了使用 FFmpeg/FFprobe 进行更通用的视频转换、修复（不同于 `video_detector.py` 中的专项修复）、预览创建和帧提取的功能。
* `assets/app_icon.ico` (可选): 应用程序图标。

## 注意事项

* 视频修复过程（尤其是高质量转换和大文件）可能需要较长时间并消耗较多系统资源。
* 请确保 FFmpeg 和 FFprobe 已正确安装并在系统路径中可访问。程序会尝试自动查找它们。

## 许可

(如果你想添加一个开源许可证，例如 MIT License, Apache 2.0 License 等，可以在这里说明。例如: 本项目采用 [MIT 许可证](LICENSE)。你需要在项目中再创建一个名为 `LICENSE` 的文件，并把许可证文本放进去。)

## 未来可能的改进

* 增加更多自定义转换参数的选项。
* 支持更多输出格式。
* 国际化/多语言支持。
* 更详细的进度反馈和预估时间。

---

希望这个项目对你有帮助！